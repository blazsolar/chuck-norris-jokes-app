machine:
  environment:
    ANDROID_HOME: /usr/local/android-sdk-linux

dependencies:
  pre:
    - echo y | android update sdk --no-ui --all --filter "platform-tools"
    - echo y | android update sdk --no-ui --all --filter "tools"
    - echo y | android update sdk --no-ui --all --filter "build-tools-21.1.2"
    - echo y | android update sdk --no-ui --all --filter "android-21"
    - echo y | android update sdk --no-ui --all --filter "extra-android-m2repository"
    - echo y | android update sdk --no-ui --all --filter "sys-img-armeabi-v7a-android-21"
  override:
    - ./gradlew dependencies

test:
  override:
  - echo no | android create avd -n testing -f -t android-21 --abi "armeabi-v7a"
  - $ANDROID_HOME/tools/emulator -avd testing -no-window -no-boot-anim -no-audio:
      background: true
      parallel: true
  - config/ci/circle/wait.sh:
      parallel: true
  - adb devices
  - ./gradlew connectedCheck:
      timeout: 600
